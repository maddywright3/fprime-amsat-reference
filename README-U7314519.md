# F´ Prime AMSAT CubeSatSim Reference Integration

First documented integration of NASA's F´ Prime flight software framework with the AMSAT CubeSatSim amateur radio satellite simulator platform.

## Overview

This reference deployment demonstrates:
- F´ Prime flight software on embedded Linux (Raspberry Pi Zero 2 W)
- AX.25 amateur radio protocol integration
- Pi Camera integration for visual telemetry
- RF communication pipeline via CubeSatSim hardware
- Command and Data Handling (C&DH) deployment architecture

## System Architecture

```
+------------------------------+
|   GDS (Ground Station)       |
|   - Command entry            |
|   - Telemetry display        |
|   - Event monitoring         |
+-------------+----------------+
              | TCP/IP (WiFi)
              v
+--------------------------------------+
|  Raspberry Pi Zero 2 W               |
|  CDHDeployment (C&DH Board)          |
|  +--------------------------------+  |
|  |  PiCameraManager               |  | <- Image capture
|  |  AMSATFramer                   |  | <- AX.25 framing
|  |  RadioBridge                   |  | <- RF interface
|  |  F´ Prime Topology             |  | <- Framework
|  +--------------------------------+  |
+---------------+----------------------+
                | UART
                v
+--------------------------------------+
|  Raspberry Pi Pico                   |
|  (Main Payload Board)                |
|  - RF Transmitter                    |
|  - Sensor Interfaces                 |
|  - Power Management                  |
+--------------------------------------+
                |
                v
            RF Antenna
```

## Components

### PiCameraManager
Captures images via Pi Camera Module v2, provides visual telemetry capability.

**Standalone component**: https://github.com/maddywright3/fprime-sensors/tree/devel/fprime-sensors/PiCamera

### AMSATFramer
Constructs AX.25 frames for amateur radio downlink, ensuring protocol compliance with AMSAT standards.

### RadioBridge
Interfaces between Pi Zero 2 W and RF hardware, manages UART communication and transmission coordination.

### CDHDeployment
Complete F´ Prime topology including command dispatcher, event logger, telemetry channels, and component interconnections.

## Hardware Requirements

### Required
- Raspberry Pi Zero 2 W (ARM Cortex-A53, 1GHz quad-core)
- Pi Camera Module v2 (Sony IMX219 sensor)
- Raspberry Pi Pico (RP2040)
- CubeSatSim RF transceiver hardware
- MicroSD card (8GB minimum)
- USB power supply

### Optional
- Amateur radio license (for RF transmission testing)
- RF test equipment (SDR, spectrum analyzer)
- Development machine (for cross-compilation)

## Software Dependencies

- F´ Prime v4.0.0
- Raspberry Pi OS (Debian-based)
- libcamera (camera stack)
- Python 3.8 or later with fprime-tools, fprime-gds
- CMake 3.16 or later
- Ninja build system
- ARM cross-compilation toolchain (for development on x86_64)

## Quick Start

### 1. Clone Repository

```bash
git clone https://github.com/maddywright3/fprime-amsat-reference.git
cd fprime-amsat-reference
```

### 2. Install Dependencies

```bash
# Create virtual environment
python3 -m venv fprime-venv
source fprime-venv/bin/activate

# Install F´ Prime tools
pip install -r requirements.txt
```

### 3. Build for ARM

```bash
# Generate build files for ARM target
fprime-util generate aarch64-linux

# Build
fprime-util build aarch64-linux
```

### 4. Deploy to Hardware

```bash
# Copy deployment binary to Pi
scp build-artifacts/aarch64-linux/CDHDeployment/bin/CDHDeployment pi@<pi-ip>:~/

# Copy dictionary for GDS
scp build-artifacts/aarch64-linux/CDHDeployment/dict/CDHDeploymentTopologyAppDictionary.xml pi@<pi-ip>:~/
```

### 5. Run on Pi

```bash
# SSH to Pi
ssh pi@<pi-ip>

# Make executable and run
chmod +x CDHDeployment
./CDHDeployment -a 0.0.0.0 -p 50000
```

### 6. Connect GDS

```bash
# On development machine
fprime-gds -n \
  --dictionary build-artifacts/aarch64-linux/CDHDeployment/dict/CDHDeploymentTopologyAppDictionary.xml \
  --ip-client \
  --ip-address <pi-ip>
```

Open browser to: http://127.0.0.1:5000/

## Usage Examples

### Capture Image

1. In GDS Commanding tab, send:
   - `piCameraMgr.ENABLE_CAMERA`
   - `piCameraMgr.CAPTURE_PHOTO`

2. Check Events tab for:
   - `PHOTO_CAPTURED_SUCCESS` with filepath and size

### Frame Telemetry for RF

1. Telemetry automatically flows through AMSATFramer
2. AX.25 frames constructed with amateur radio protocol
3. Frames sent to RadioBridge for transmission

### Monitor System Health

1. GDS Events tab shows all component status
2. Telemetry tab displays real-time data
3. Commanding tab for system control

## Component Integration

This deployment integrates:

| Component | Function | Repository |
|-----------|----------|------------|
| PiCameraManager | Image capture | [fprime-sensors](https://github.com/maddywright3/fprime-sensors/tree/devel/fprime-sensors/PiCamera) |
| AMSATFramer | AX.25 framing | This repo |
| RadioBridge | RF interface | This repo |
| F´ Prime Framework | Flight software infrastructure | [NASA F´ Prime](https://github.com/nasa/fprime) |

## Documentation

- **Setup Guide**: [docs/SETUP.md](docs/SETUP.md) - Detailed installation and configuration
- **Testing Guide**: [docs/TESTING.md](docs/TESTING.md) - Validation procedures
- **Architecture**: [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md) - System design
- **RF Testing**: [docs/RF_TESTING.md](docs/RF_TESTING.md) - Radio transmission validation

## Key Achievements

- First documented F´ Prime + CubeSatSim integration
- AX.25 amateur radio protocol implementation in F´ Prime
- Cross-platform embedded Linux deployment (x86_64 to ARM)
- Complete command/telemetry/event infrastructure
- Visual telemetry via Pi Camera integration
- Contribution to open-source fprime-sensors repository

## Testing

System validated through:
- Hardware verification (camera, RF hardware)
- Component integration testing
- Command/telemetry flow validation
- Image capture verification
- Event logging confirmation
- End-to-end system functionality

See [TESTING.md](docs/TESTING.md) for complete procedures and results.

## Troubleshooting

### Camera Issues
```bash
# Verify camera detection
sudo i2cdetect -y 10
libcamera-hello --list-cameras
```

### Build Issues
```bash
# Clean build cache
fprime-util purge

# Reinstall dependencies
pip install -r requirements.txt
```

### Connection Issues
```bash
# Check Pi is listening
netstat -tuln | grep 50000

# Test TCP connection
telnet <pi-ip> 50000
```

## Future Enhancements

- Asynchronous image capture
- Direct RF transmission path testing
- Additional sensor component integration
- Ground station software for amateur radio operators
- Educational curriculum development

## Contributing

Contributions welcome. Please:
1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Open a Pull Request

For major changes, please open an issue first to discuss proposed changes.

## Acknowledgments

- **NASA Jet Propulsion Laboratory** - F´ Prime framework and documentation
- **AMSAT** - CubeSatSim platform and amateur radio community
- **fprime-community** - fprime-sensors repository and component support
- **Australian National University** - Project support and academic supervision

## Related Projects

- **F´ Prime Framework**: https://nasa.github.io/fprime/
- **CubeSatSim**: https://github.com/alanbjohnston/CubeSatSim
- **fprime-sensors**: https://github.com/fprime-community/fprime-sensors
- **PiCameraManager**: https://github.com/maddywright3/fprime-sensors/tree/devel/fprime-sensors/PiCamera
---

**Status**: Complete thesis project (November 2024)  
**F´ Prime Version**: 4.0.0  
**Hardware Platform**: Raspberry Pi Zero 2 W + Pico  
**RF Protocol**: AX.25 (Amateur Radio)
